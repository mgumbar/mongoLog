@model List<MongoLog.Models.Workflow>
@{ViewBag.Title = "Search";}
<div class="col-xs-12 col-sm-9 content">
    <div class="panel panel-default">
        <div class="panel-heading">
            <h3 class="panel-title"><a href="javascript:void(0);" class="toggle-sidebar"><span class="fa fa-angle-double-left" data-toggle="offcanvas" title="Maximize Panel"></span></a> Active Monitoring: @Model.Count().ToString() Found(s)</h3>
        </div>
        <div class="panel-body">
            <div class="content-row">
                <div class="row">
                    @using (Html.BeginForm("Index", "Amon", FormMethod.Get, new { @class = "form" }))
    {
                <div class="col-md-2">
                    @Html.TextBox("source", null, new { @class = "form-control", @id = "source", @placeholder = "Application" })
                </div>

                <div class="col-md-2">
                    @Html.TextBox("startDate", null, new { @class = "form-control", @id = "startDate", @placeholder = "Star date" })
                </div>

                <div class="col-md-2">
                    @Html.TextBox("endDate", null, new { @class = "form-control", @id = "endDate", @placeholder = "End date" })
                </div>

                <div class="col-md-2">
                    @Html.TextBox("search", null, new { @class = "form-control", @id = "search", @placeholder = "Search" })
                </div>

                <div class="col-md-2">
                    <button type="submit" class="btn btn-default">Submit</button>
                </div>
}
                </div>

                <div class="row">

                    <div class="bs-example" data-example-id="contextual-table">
                        <table class="table">
                            <thead> <tr> <th>Application</th> <th>Updated at </th> <th>Created at </th> <th>Attributes</th> <th>Workflow</th> </tr> </thead>
                            <tbody>
                                @* .active, .success, .info, .warning, .danger *@
                                @foreach (var item in Model)
                                {
                                    <tr class="">
                                        <td>@item.Source.ToString()</td>
                                        <td>@item.UpdatedAt.ToString()</td>
                                        <td>@item.CreatedAt.ToString()</td>
                                        <td>
                                            <dl class="dl-horizontal">
                                            @foreach (KeyValuePair<string, string> payload in item.Payload)
                                            { 
                                              <dt>@payload.Key</dt>
                                              <dd>@payload.Value</dd>
                                            }
                                            </dl>
                                        </td>
                                        <td>
                                            @foreach (MongoLog.Models.Step step in item.Steps)
                                            {
                                                    <a href="Search?application=@item.SourceLower()&startDate=@item.UpdatedAtUi(-1)&endDate=@item.UpdatedAtUi(+1)&data=&logName=">
                                                <span class="label label-@step.Status" style="margin-left:5px">
                                                    @*<a href="/events/@step.Name/@item.ClientKey">*@
                                                    @step.Label
                                                    @*</a>*@
                                                </span>
                                                    </a>
                                            }
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div><!-- panel body -->
    </div><!-- panel-default -->
</div><!-- panel content-9 -->
